CREATE OR ALTER PROCEDURE dbo.sp_DeleteBook(@Id INT)
AS
BEGIN

	SET NOCOUNT ON
	SET XACT_ABORT ON

	BEGIN TRY
		BEGIN TRANSACTION
			DELETE FROM Books WITH(UPDLOCK, ROWLOCK) WHERE Id = @Id

			IF @@ROWCOUNT = 0
				RAISERROR('Запись с Id: %d не найдена', 16, 1, @Id)

		COMMIT TRANSACTION
	END TRY
	BEGIN CATCH
		IF @@TRANCOUNT > 0
			ROLLBACK TRANSACTION

		SELECT ERROR_MESSAGE() AS ErrorMessage
	END CATCH
END
GO
